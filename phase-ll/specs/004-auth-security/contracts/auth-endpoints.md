# API Contract: Authentication Endpoints

**Feature**: Authentication & Security
**Date**: 2026-02-08
**Status**: Complete

## Overview

This document defines the API contracts for authentication endpoints provided by Better Auth. These endpoints are automatically generated by Better Auth and handle user signup, signin, and session management.

---

## Base URL

**Development**: `http://localhost:3000/api/auth`
**Production**: `https://yourdomain.com/api/auth`

All authentication endpoints are prefixed with `/api/auth` and are handled by Better Auth's Next.js API routes.

---

## Endpoint 1: User Signup

**Purpose**: Create a new user account and issue a JWT token

### Request

**Method**: `POST`
**Path**: `/api/auth/signup`
**Content-Type**: `application/json`

**Request Body**:
```json
{
  "email": "user@example.com",
  "password": "securepassword123"
}
```

**Request Schema**:
| Field | Type | Required | Validation |
|-------|------|----------|------------|
| email | string | Yes | Valid email format (RFC 5322) |
| password | string | Yes | Minimum 8 characters |

### Response

**Success Response** (201 Created):
```json
{
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "createdAt": "2026-02-08T10:30:00Z"
  },
  "session": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresAt": "2026-02-15T10:30:00Z"
  }
}
```

**Response Schema**:
| Field | Type | Description |
|-------|------|-------------|
| user.id | UUID | Unique user identifier |
| user.email | string | User's email address |
| user.createdAt | ISO 8601 | Account creation timestamp |
| session.token | string | JWT access token |
| session.expiresAt | ISO 8601 | Token expiration timestamp |

**Error Responses**:

**400 Bad Request** - Invalid input:
```json
{
  "error": "Invalid email format",
  "code": "INVALID_EMAIL"
}
```

**409 Conflict** - Email already exists:
```json
{
  "error": "Email already registered",
  "code": "EMAIL_EXISTS"
}
```

**422 Unprocessable Entity** - Password too short:
```json
{
  "error": "Password must be at least 8 characters",
  "code": "PASSWORD_TOO_SHORT"
}
```

### Example Usage

**cURL**:
```bash
curl -X POST http://localhost:3000/api/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "securepassword123"
  }'
```

**JavaScript (fetch)**:
```javascript
const response = await fetch('/api/auth/signup', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'securepassword123',
  }),
});

const data = await response.json();
console.log('JWT Token:', data.session.token);
```

---

## Endpoint 2: User Signin

**Purpose**: Authenticate an existing user and issue a JWT token

### Request

**Method**: `POST`
**Path**: `/api/auth/signin`
**Content-Type**: `application/json`

**Request Body**:
```json
{
  "email": "user@example.com",
  "password": "securepassword123"
}
```

**Request Schema**:
| Field | Type | Required | Validation |
|-------|------|----------|------------|
| email | string | Yes | Valid email format |
| password | string | Yes | Any length (verified against hash) |

### Response

**Success Response** (200 OK):
```json
{
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "createdAt": "2026-02-08T10:30:00Z"
  },
  "session": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresAt": "2026-02-15T10:30:00Z"
  }
}
```

**Response Schema**: Same as signup response

**Error Responses**:

**401 Unauthorized** - Invalid credentials:
```json
{
  "error": "Invalid credentials",
  "code": "INVALID_CREDENTIALS"
}
```

**400 Bad Request** - Missing fields:
```json
{
  "error": "Email and password are required",
  "code": "MISSING_FIELDS"
}
```

### Example Usage

**cURL**:
```bash
curl -X POST http://localhost:3000/api/auth/signin \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "securepassword123"
  }'
```

**JavaScript (fetch)**:
```javascript
const response = await fetch('/api/auth/signin', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'securepassword123',
  }),
});

const data = await response.json();
localStorage.setItem('jwt_token', data.session.token);
```

---

## Endpoint 3: Get Current Session

**Purpose**: Retrieve the current user's session information

### Request

**Method**: `GET`
**Path**: `/api/auth/session`
**Authentication**: Required (Cookie or Authorization header)

**Headers**:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Response

**Success Response** (200 OK):
```json
{
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "createdAt": "2026-02-08T10:30:00Z"
  },
  "session": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresAt": "2026-02-15T10:30:00Z"
  }
}
```

**Error Responses**:

**401 Unauthorized** - No session:
```json
{
  "error": "Not authenticated",
  "code": "NOT_AUTHENTICATED"
}
```

### Example Usage

**JavaScript (fetch)**:
```javascript
const response = await fetch('/api/auth/session', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('jwt_token')}`,
  },
});

const data = await response.json();
console.log('Current user:', data.user.email);
```

---

## Endpoint 4: User Signout

**Purpose**: Invalidate the current user's session

### Request

**Method**: `POST`
**Path**: `/api/auth/signout`
**Authentication**: Required

**Headers**:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Response

**Success Response** (200 OK):
```json
{
  "success": true,
  "message": "Signed out successfully"
}
```

**Error Responses**:

**401 Unauthorized** - No session:
```json
{
  "error": "Not authenticated",
  "code": "NOT_AUTHENTICATED"
}
```

### Example Usage

**JavaScript (fetch)**:
```javascript
const response = await fetch('/api/auth/signout', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('jwt_token')}`,
  },
});

localStorage.removeItem('jwt_token');
window.location.href = '/signin';
```

---

## Protected Backend Endpoints

All backend API endpoints under `/api/tasks` require JWT authentication via the Authorization header.

### Authentication Flow

1. **Frontend**: Retrieve JWT from localStorage
2. **Frontend**: Add Authorization header to request
3. **Backend**: Extract token from header
4. **Backend**: Verify token signature with BETTER_AUTH_SECRET
5. **Backend**: Validate token expiration
6. **Backend**: Extract user ID from token
7. **Backend**: Process request with authenticated user context

### Example Protected Request

**Request**:
```bash
curl -X GET http://localhost:8000/api/tasks \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**Success Response** (200 OK):
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "Complete project",
    "description": "Finish authentication feature",
    "is_completed": false,
    "created_at": "2026-02-08T10:30:00Z",
    "updated_at": "2026-02-08T10:30:00Z"
  }
]
```

**Error Response** (401 Unauthorized):
```json
{
  "error": "Invalid token",
  "code": "INVALID_TOKEN"
}
```

---

## Error Code Reference

| Code | HTTP Status | Description |
|------|-------------|-------------|
| INVALID_EMAIL | 400 | Email format is invalid |
| EMAIL_EXISTS | 409 | Email already registered |
| PASSWORD_TOO_SHORT | 422 | Password less than 8 characters |
| INVALID_CREDENTIALS | 401 | Email or password incorrect |
| MISSING_FIELDS | 400 | Required fields not provided |
| NOT_AUTHENTICATED | 401 | No valid session found |
| INVALID_TOKEN | 401 | JWT signature invalid or malformed |
| TOKEN_EXPIRED | 401 | JWT expiration time passed |
| MISSING_TOKEN | 401 | No Authorization header provided |

---

## Security Considerations

1. **HTTPS Required**: All authentication endpoints MUST use HTTPS in production
2. **Rate Limiting**: Implement rate limiting on signup/signin to prevent brute force
3. **Password Hashing**: Passwords automatically hashed by Better Auth (bcrypt/argon2)
4. **Token Security**: JWT tokens should be stored securely (httpOnly cookies preferred)
5. **CORS**: Backend must allow frontend origin in CORS configuration
6. **Secret Management**: BETTER_AUTH_SECRET must be kept secure and never exposed

---

## Testing Checklist

- [ ] Signup with valid email and password succeeds
- [ ] Signup with existing email returns 409 error
- [ ] Signup with invalid email returns 400 error
- [ ] Signup with short password returns 422 error
- [ ] Signin with correct credentials succeeds
- [ ] Signin with incorrect password returns 401 error
- [ ] Signin with non-existent email returns 401 error
- [ ] JWT token is returned after successful authentication
- [ ] JWT token can be used to access protected endpoints
- [ ] Invalid JWT token returns 401 error
- [ ] Expired JWT token returns 401 error
- [ ] Missing JWT token returns 401 error
- [ ] Signout invalidates session

---

## Summary

**Total Endpoints**: 4 (signup, signin, session, signout)
**Authentication Method**: JWT via Authorization header
**Token Expiration**: 7 days
**Password Requirements**: Minimum 8 characters
**Error Handling**: Consistent error format with codes

**Next Steps**:
- Implement Better Auth configuration
- Create signup/signin UI pages
- Test authentication flow end-to-end
